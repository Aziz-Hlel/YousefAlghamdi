ygp.ae { # Replace with your actual domain
    # Root directory for your frontend build files (e.g., React's build folder)
    root * /srv

    # Compress responses (good to keep)
    encode gzip zstd

    # --- API Backend Proxy ---
    # Match requests starting with /api/
    @api path /api/*
    # Proxy these requests to your backend server
    # Ensure 'server-prod:5000' is correct. If backend is on the same EC2,
    # use 'localhost:5000' or '127.0.0.1:5000'.
    reverse_proxy @api server:5000

    # --- SPA Frontend Handling ---
    # Match requests that are NOT for the API and NOT for an existing static file
    @spa {
        not path /api/*
        not file
    }
    # Rewrite these SPA requests to /index.html so your client-side router can take over
    rewrite @spa /index.html

    # Serve static files from the root directory
    file_server

    # Caddy handles automatic HTTPS (including TLS protocols) by default
    # Caddy logs to standard output by default, which is often fine for Docker/systemd
    # Caddy has default error handling
}